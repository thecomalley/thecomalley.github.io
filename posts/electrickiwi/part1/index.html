<!doctype html><html lang=en><head><title>Monitoring Electricity usage to save $$ - Part 1</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.4d6a544f9b1066b5e9c5c8df01cdefd8317ade3c0403d45c2388255e465efad3.css integrity="sha256-TWpUT5sQZrXpxcjfAc3v2DF63jwEA9RcI4glXkZe+tM="><link rel=icon type=image/png href=/images/favicon_hu6033012544709787652.png><meta property="og:url" content="https://thecomalley.github.io/posts/electrickiwi/part1/"><meta property="og:site_name" content="Chris O'Malley"><meta property="og:title" content="Monitoring Electricity usage to save $$ - Part 1"><meta property="og:description" content="Monitoring Electricity usage to save money, with Home Assistant & Azure Functions"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-13T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-13T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Monitoring Electricity usage to save $$ - Part 1"><meta name=twitter:description content="Monitoring Electricity usage to save money, with Home Assistant & Azure Functions"><meta name=description content="Monitoring Electricity usage to save money, with Home Assistant & Azure Functions"><script>theme=localStorage.getItem("darkmode:color-scheme")||"system",theme=="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/main-logo_hu8435294941152094943.png id=logo alt=Logo>
Chris O'Malley</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class=nav-item><a class=nav-link href=/#projects>Projects</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li></ul></div></div><img src=/images/main-logo_hu8435294941152094943.png class=d-none id=main-logo alt=Logo>
<img src=/images/inverted-logo_hu6033012544709787652.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><a class=list-link href=/posts/ansible/ title=Ansible>Ansible</a></li><li><a class=list-link href=/posts/git-emails/ title="Git Configuration">Git Configuration</a></li><li><a class=list-link href=/posts/cron/ title="Monitoring cron jobs">Monitoring cron jobs</a></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/electrickiwi/> Monitoring Electricity usage</a><ul class=active><li><a class="active list-link" href=/posts/electrickiwi/part1/ title="Part 1 - Getting the data">Part 1 - Getting the data</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/chris_hu6050858549766099883.jpg alt="Author Image"><h5 class=author-name>Chris O'Malley</h5><p class=text-muted>Wednesday, October 13, 2021</p></div><div class=title><h1>Monitoring Electricity usage to save $$ - Part 1</h1></div><div class=post-content id=post-content><p>The electricity provider i&rsquo;m with offers a changeable free &ldquo;Hour Of Power&rdquo; every day (off peak hours) So we set about making the most of this in our household, running the dishwasher washing machine and hot water all during this hour. But after a while we fell out of the habit, adjusting our lifestyle to fit this hour wasn&rsquo;t really working&mldr; Luckily the Electricity provider does provide the ability to change the Hour of Power for the current day (up to 11:59pm each day)</p><h3 id=we-can-break-the-problem-of-automating-this-down-into-three-parts>We can break the problem of automating this down into three parts</h3><p>Part 1 - Collecting realtime power consumption data
Part 2 - Analysing data to find peak usage & updating the hour of power</p><h2 id=part-1-collecting-realtime-power-consumption-data>Part 1. Collecting realtime power consumption data</h2><p>The first real problem is access to data. despite the so called <em>smart meters</em> its really hard to get access to your own data! now the electricity company&rsquo;s obviously have this and most are pretty good about displaying it back to the user via their respective apps, but nearly all suffer a delay of at lest a day&mldr; that&rsquo;s not gonna cut it for us since we need to run a calculation before midnight each day.</p><p>After a some advice from a colleague i picked up an <a href=https://efergy.com/engage/ target=_blank rel=noopener>efergy Engage Hub Kit</a> second hand from TradeMe, as it has an <a href=https://www.home-assistant.io/integrations/efergy/ target=_blank rel=noopener>integration</a> for my favourite Home Automation Platform <a href=https://www.home-assistant.io/ target=_blank rel=noopener>Home Assistant</a> however when setting it up i was unable to register the hub. It looks to still be tied to the previous owners account. Efergy support has been unresponsive as well so not of to a great start!</p><p>After a bit of googling i stumbled across the awesome opensource project <a href=https://github.com/merbanan/rtl_433 target=_blank rel=noopener>rtl_433</a> it just so happens that the Effergy transmitters have been decoded by the project! so after a quick visit back to Trademe (not patient enough for an Ali order by this point) i picked up a cheap <a href=https://www.trademe.co.nz/a/marketplace/electronics-photography/home-audio/amplifiers-tuners/listing/329576599 target=_blank rel=noopener>Software Defined Radio</a></p><p>Pulling out the Raspberry Pi i installed <a href=https://github.com/merbanan/rtl_433 target=_blank rel=noopener>rtl_433</a> using <a href=https://www.sensorsiot.org/install-rtl_433-for-a-sdr-rtl-dongle-on-a-raspberry-pi/ target=_blank rel=noopener>this guide</a> and started scanning for messages&mldr;</p><p>Bingo! there it was the data right from the transmitter no need for a engage hub</p><h2 id=ingesting-the-data>Ingesting the Data</h2><p>Now we needed to get the data into Home Assistant so i could use the awesome new <a href=https://www.home-assistant.io/blog/2021/08/04/home-energy-management/ target=_blank rel=noopener>Energy Management Feature</a>.</p><p>I found a Home assistant addon (Docker Container) for running <a href=https://github.com/pbkhrv/rtl_433-hass-addons/tree/main/rtl_433 target=_blank rel=noopener>rtl_433</a> that sends the output from rtl_433 to a MQTT</p><p>I already have MQTT server running so i spun up the container added a config file <code>rtl_433.conf</code> and ran rtl_433 again <code>frequency</code> & <code>protocol</code></p><pre tabindex=0><code class=language-conf data-lang=conf>output      mqtt://HOST:PORT,user=XXXX,pass=YYYYYYY

frequency   433.485M
protocol    36

convert     si
report_meta newmodel
</code></pre><h3 id=image-of-mqtt-explorer>Image of MQTT explorer</h3><p>Now the data was being sent to MQTT we needed to get it into Home Assistant</p><p>Here we are defining a sensor looking at the current / Amps that the Transmitter is reporting, but really we need kWh so we need to do a bit more work</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>sensor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>mqtt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;House Current&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>device_class</span>: <span style=color:#e6db74>&#34;current&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>unit_of_measurement</span>: <span style=color:#e6db74>&#34;A&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state_topic</span>: <span style=color:#e6db74>&#34;rtl_433/9b13b3f4-rtl433/devices/Efergy-e2CT/34737/current&#34;</span>
</span></span></code></pre></div><hr><p>Now faced with a Year 10 Physics lesson we needed to convert the Amps into Watts. we do this by multiplying by 240.
Its not completely accurate because the voltage isn&rsquo;t always a constant 240v but its good enough for now</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>sensor</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;House Power&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>unit_of_measurement</span>: <span style=color:#e6db74>&#34;W&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>device_class</span>: <span style=color:#e6db74>&#34;power&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>state</span>: <span style=color:#e6db74>&#34;{{ states(&#39;sensor.house_current&#39;) | float * 240 }}&#34;</span>
</span></span></code></pre></div><p>Finally using the confusingly named <a href=https://www.home-assistant.io/integrations/integration/ target=_blank rel=noopener>integration</a> integration</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>sensor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>integration</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>source</span>: <span style=color:#ae81ff>sensor.house_power</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;House Energy&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>unit_prefix</span>: <span style=color:#ae81ff>k</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>round</span>: <span style=color:#ae81ff>2</span>
</span></span></code></pre></div></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://thecomalley.github.io/#home/edit/main/content/posts/electrickiwi/part1.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/cron/ title="Monitoring cron jobs with healthchecks.io" class="btn filled-button"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>Monitoring cron jobs with healthchecks.io</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#we-can-break-the-problem-of-automating-this-down-into-three-parts>We can break the problem of automating this down into three parts</a></li></ul></li><li><a href=#part-1-collecting-realtime-power-consumption-data>Part 1. Collecting realtime power consumption data</a></li><li><a href=#ingesting-the-data>Ingesting the Data</a><ul><li><a href=#image-of-mqtt-explorer>Image of MQTT explorer</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://thecomalley.github.io/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://thecomalley.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://thecomalley.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://thecomalley.github.io/#projects>Projects</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=https://github.com/thecomalley target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>thecomalley</span></a></li><li><a href=https://www.linkedin.com/in/thecomalley target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Chris O'Malley</span></a></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form method=post action=https://blogtrottr.com><div class=form-group><input type=email class=form-control name=btr_email placeholder="Enter email"><br><input type=hidden name=btr_url value=https://thecomalley.github.io//index.xml>
<input type=hidden name=schedule_type value=1>
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small>
<button type=submit class="btn btn-info"> Submit</button></div></form></div></div></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu16779671404603505019.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2024 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.d2e0773eae852ce8e44ec4d047d999887780cc53c25d218d2429c627d3b9aef5.js integrity="sha256-0uB3Pq6FLOjkTsTQR9mZiHeAzFPCXSGNJCnGJ9O5rvU=" defer></script></body></html>